var te=Object.defineProperty;var se=(t,s,l)=>s in t?te(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l;var G=(t,s,l)=>se(t,typeof s!="symbol"?s+"":s,l);import{j as e,M as ne}from"./markdown-DxlUM-aa.js";import{a as ae,r as u,R as oe}from"./vendor-DJ1oPbzn.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function l(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=l(n);fetch(n.href,a)}})();var H={},Y=ae;H.createRoot=Y.createRoot,H.hydrateRoot=Y.hydrateRoot;const re=({title:t="ChatGPT",onBack:s,showBack:l=!1,onSettings:i,showSettings:n=!1})=>e.jsx("div",{className:"chat-header",children:e.jsxs("div",{className:"header-content",children:[l&&e.jsx("button",{className:"back-button",onClick:s,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"})})}),e.jsxs("div",{className:"header-info",children:[e.jsx("div",{className:"contact-avatar",children:e.jsx("div",{className:"avatar-initials",children:"AI"})}),e.jsxs("div",{className:"contact-details",children:[e.jsx("div",{className:"contact-name",children:t}),e.jsx("div",{className:"contact-status",children:"Active now"})]})]}),e.jsx("div",{className:"header-actions",children:n&&i&&e.jsx("button",{className:"action-button",onClick:i,"aria-label":"Settings",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"})})})})]})}),J=({message:t})=>{const s=t.sender==="user",l=i=>i.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs("div",{className:`message-container ${s?"user":"assistant"}`,children:[e.jsx("div",{className:`message-bubble ${s?"user":"assistant"}`,children:t.isTyping?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}):e.jsx("div",{className:"message-content",children:e.jsx(ne,{children:t.content})})}),!t.isTyping&&e.jsx("div",{className:"message-timestamp",children:l(t.timestamp)})]})},ie=({messages:t,isLoading:s=!1})=>{const l=u.useRef(null),i=()=>{var a;(a=l.current)==null||a.scrollIntoView({behavior:"smooth"})};u.useEffect(()=>{i()},[t]);const n=(a,r)=>r?a.timestamp.getTime()-r.timestamp.getTime()>3e5:!0;return e.jsx("div",{className:"chat-view",children:e.jsxs("div",{className:"messages-container",children:[t.length===0?e.jsx("div",{className:"welcome-message",children:e.jsxs("div",{className:"welcome-content",children:[e.jsx("div",{className:"ai-avatar",children:e.jsx("div",{className:"avatar-initials",children:"AI"})}),e.jsx("h2",{children:"Welcome to ChatGPT"}),e.jsx("p",{children:"I'm here to help you with questions, creative tasks, analysis, and more. What would you like to explore today?"})]})}):t.map((a,r)=>e.jsxs("div",{children:[n(a,t[r-1])&&e.jsx("div",{className:"timestamp-divider",children:a.timestamp.toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}),e.jsx(J,{message:a})]},a.id)),s&&e.jsx(J,{message:{id:"typing",content:"",sender:"assistant",timestamp:new Date,isTyping:!0}}),e.jsx("div",{ref:l})]})})},le=({onSendMessage:t,disabled:s=!1,placeholder:l="iMessage"})=>{const[i,n]=u.useState(""),a=u.useRef(null),r=()=>{i.trim()&&!s&&(t(i.trim()),n(""),setTimeout(()=>{var c;(c=a.current)==null||c.focus()},0))},f=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),r())},g=c=>{n(c.target.value)};u.useEffect(()=>{a.current&&(a.current.style.height="auto",a.current.style.height=`${a.current.scrollHeight}px`)},[i]),u.useEffect(()=>{a.current&&!s&&a.current.focus()},[s]);const v=i.trim().length>0&&!s;return e.jsx("div",{className:"message-input-container",children:e.jsxs("div",{className:"input-wrapper",children:[e.jsx("textarea",{ref:a,value:i,onChange:g,onKeyDown:f,placeholder:l,disabled:s,rows:1,className:"message-textarea"}),e.jsx("button",{onClick:c=>{c.preventDefault(),r()},onMouseDown:c=>{c.preventDefault()},disabled:!v,className:`send-button ${v?"active":""}`,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})})},ce=({isOpen:t,title:s,message:l,confirmText:i="Delete",cancelText:n="Cancel",onConfirm:a,onCancel:r,destructive:f=!1})=>t?e.jsx("div",{className:"confirm-dialog-overlay",onClick:r,children:e.jsxs("div",{className:"confirm-dialog",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"confirm-dialog-content",children:[e.jsx("h3",{className:"confirm-dialog-title",children:s}),e.jsx("p",{className:"confirm-dialog-message",children:l})]}),e.jsxs("div",{className:"confirm-dialog-actions",children:[e.jsx("button",{className:"confirm-dialog-button cancel",onClick:r,children:n}),e.jsx("button",{className:`confirm-dialog-button confirm ${f?"destructive":""}`,onClick:a,children:i})]})]})}):null,de=({conversations:t,onSelectConversation:s,onNewConversation:l,onDeleteConversation:i,onOpenSettings:n})=>{const[a,r]=u.useState({isOpen:!1,conversationId:"",conversationTitle:""}),f=d=>{const S=new Date().getTime()-d.getTime(),b=Math.floor(S/(1e3*60*60*24));return b===0?d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):b===1?"Yesterday":b<7?d.toLocaleDateString("en-US",{weekday:"short"}):d.toLocaleDateString("en-US",{month:"short",day:"numeric"})},g=(d,x=60)=>d.length<=x?d:d.substring(0,x).trim()+"...",v=(d,x)=>{x.stopPropagation(),r({isOpen:!0,conversationId:d.id,conversationTitle:d.title})},c=()=>{i(a.conversationId),r({isOpen:!1,conversationId:"",conversationTitle:""})},N=()=>{r({isOpen:!1,conversationId:"",conversationTitle:""})};return e.jsxs("div",{className:"conversation-list",children:[e.jsxs("div",{className:"conversation-list-header",children:[e.jsx("div",{className:"header-left",children:e.jsx("button",{className:"settings-button",onClick:n,"aria-label":"Settings",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"})})})}),e.jsx("h1",{children:"Messages"}),e.jsx("div",{className:"header-right",children:e.jsx("button",{className:"new-conversation-button",onClick:l,"aria-label":"New conversation",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})})]}),e.jsx("div",{className:"conversations-container",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:e.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"})})}),e.jsx("h2",{children:"No conversations yet"}),e.jsx("p",{children:"Tap the + button to start your first conversation"})]}):t.map(d=>e.jsxs("div",{className:"conversation-item",onClick:()=>s(d.id),children:[e.jsx("div",{className:"conversation-avatar",children:e.jsx("div",{className:"avatar-initials",children:"AI"})}),e.jsxs("div",{className:"conversation-info",children:[e.jsxs("div",{className:"conversation-header",children:[e.jsx("span",{className:"conversation-title",children:d.title}),e.jsx("span",{className:"conversation-time",children:f(d.updatedAt)})]}),e.jsx("div",{className:"conversation-preview",children:d.lastMessage?g(d.lastMessage):"Start a conversation..."})]}),e.jsxs("div",{className:"conversation-actions",children:[e.jsx("button",{className:"delete-button",onClick:x=>v(d,x),"aria-label":"Delete conversation",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})}),e.jsx("div",{className:"conversation-chevron",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})]},d.id))}),e.jsx(ce,{isOpen:a.isOpen,title:"Delete Conversation",message:`Are you sure you want to delete "${a.conversationTitle}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",onConfirm:c,onCancel:N,destructive:!0})]})},B={ai:{apiKey:"",endpoint:"https://api.openai.com/v1",model:"gpt-3.5-turbo",temperature:.7,maxTokens:2e3}},I=[{id:"openai",name:"OpenAI",url:"https://api.openai.com/v1",requiresKey:!0},{id:"ollama-local",name:"Ollama (Local)",url:"http://localhost:11434/v1",requiresKey:!1},{id:"ollama-remote",name:"Ollama (Remote)",url:"",requiresKey:!1},{id:"lmstudio",name:"LM Studio (Local)",url:"http://localhost:1234/v1",requiresKey:!1},{id:"together",name:"Together AI",url:"https://api.together.xyz/v1",requiresKey:!0},{id:"custom",name:"Custom Endpoint",url:"",requiresKey:!0}],X="pwa_imessage_settings",ee=t=>{try{localStorage.setItem(X,JSON.stringify(t))}catch(s){console.error("Error saving settings:",s)}},O=()=>{try{const t=localStorage.getItem(X);if(!t)return B;const s=JSON.parse(t);return{...B,...s,ai:{...B.ai,...s.ai}}}catch(t){return console.error("Error loading settings:",t),B}},ue=()=>{try{const t=localStorage.getItem("openai_api_key"),s=O();return t&&!s.ai.apiKey&&(s.ai.apiKey=t,ee(s),localStorage.removeItem("openai_api_key")),s}catch(t){return console.error("Error migrating settings:",t),O()}},z=t=>{try{const s=new URL(t);return s.protocol==="http:"||s.protocol==="https:"}catch{return!1}},D=t=>{try{const s=new URL(t);return s.hostname==="localhost"||s.hostname==="127.0.0.1"||s.hostname.startsWith("192.168.")||s.hostname.startsWith("10.")||s.hostname.startsWith("172.")}catch{return!1}},me=async(t,s,l=5e3)=>{try{const i=`${t}/models`,n=D(t),a={"Content-Type":"application/json"};s&&!n?a.Authorization=`Bearer ${s}`:s&&n&&(a.Authorization=`Bearer ${s}`);const r=new AbortController,f=setTimeout(()=>r.abort(),l),g=await fetch(i,{method:"GET",headers:a,signal:r.signal});if(clearTimeout(f),!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const v=await g.json();if(!v.data||!Array.isArray(v.data))throw new Error("Invalid models response format");return v.data.map(N=>N.id).filter(N=>N&&typeof N=="string").sort()}catch(i){if(console.warn("Failed to fetch models from endpoint:",t,i),i instanceof Error){if(i.name==="AbortError")throw new Error("Request timeout - endpoint may be unreachable");if(i.message.includes("Failed to fetch")||i.message.includes("network"))throw new Error("Network error - check if the endpoint is accessible");if(i.message.includes("401")||i.message.includes("403"))throw new Error("Authentication failed - check your API key")}throw i}},F=t=>{switch(t){case"openai":return["gpt-3.5-turbo","gpt-4","gpt-4-turbo","gpt-4o","gpt-4o-mini"];case"ollama-local":case"ollama-remote":return["llama3","llama2","mistral","codellama","vicuna","orca-mini","phi3"];case"lmstudio":return["local-model"];case"together":return["meta-llama/Llama-2-7b-chat-hf","mistralai/Mistral-7B-Instruct-v0.1","NousResearch/Nous-Hermes-2-Yi-34B"];default:return["gpt-3.5-turbo"]}},W=({isOpen:t,onClose:s,onSettingsChange:l,required:i=!1})=>{const[n,a]=u.useState(O()),[r,f]=u.useState("openai"),[g,v]=u.useState(""),[c,N]=u.useState({}),[d,x]=u.useState([]),[S,b]=u.useState(!1),[k,M]=u.useState("");u.useEffect(()=>{if(t){const o=O();a(o);const h=I.find(j=>j.url===o.ai.endpoint);h?f(h.id):o.ai.endpoint.includes("/v1")&&!o.ai.endpoint.includes("localhost")&&!o.ai.endpoint.includes("127.0.0.1")?(f("ollama-remote"),v(o.ai.endpoint)):(f("custom"),v(o.ai.endpoint))}},[t]);const L=(o,h)=>{if(!o||!z(o))return!1;const j=I.find($=>$.id===h);return!!(j&&j.url||(h==="custom"||h==="ollama-remote")&&o.includes("/v1"))};u.useEffect(()=>{if(t&&L(n.ai.endpoint,r)){const o=setTimeout(()=>{E(n.ai.endpoint,n.ai.apiKey)},1e3);return()=>clearTimeout(o)}else x(F(r))},[t,n.ai.endpoint,n.ai.apiKey,r]);const C=o=>{f(o);const h=I.find(j=>j.id===o);h&&h.id!=="custom"&&h.id!=="ollama-remote"?(a(j=>({...j,ai:{...j.ai,endpoint:h.url}})),v("")):o==="ollama-remote"&&(g||v("http://your-server:11434/v1"))},U=o=>{v(o),(r==="custom"||r==="ollama-remote")&&a(h=>({...h,ai:{...h.ai,endpoint:o}}))},m=()=>{const o={};z(n.ai.endpoint)||(o.endpoint="Please enter a valid URL");const h=I.find(q=>q.url===n.ai.endpoint)||I.find(q=>q.id===r),j=(h==null?void 0:h.requiresKey)!==!1,$=D(n.ai.endpoint);return j&&!$&&!n.ai.apiKey.trim()&&(o.apiKey="API key is required for this endpoint"),n.ai.model.trim()||(o.model="Model is required"),(n.ai.temperature<0||n.ai.temperature>2)&&(o.temperature="Temperature must be between 0 and 2"),(n.ai.maxTokens<1||n.ai.maxTokens>8e3)&&(o.maxTokens="Max tokens must be between 1 and 8000"),N(o),Object.keys(o).length===0},p=()=>{m()&&(ee(n),l(n),s())},w=()=>{if(confirm("Reset all settings to defaults? This cannot be undone.")){const o=O();a(o),f("openai"),v(""),N({})}},E=async(o,h)=>{if(!o||!z(o)){x(F(r));return}b(!0),M("");try{const j=await me(o,h,8e3);x(j)}catch(j){console.warn("Failed to fetch models:",j),M(j instanceof Error?j.message:"Failed to fetch models"),x(F(r))}finally{b(!1)}},K=()=>d.length>0?d:F(r);if(!t)return null;const T=I.find(o=>o.url===n.ai.endpoint)||I.find(o=>o.id===r),A=(T==null?void 0:T.requiresKey)!==!1,R=D(n.ai.endpoint);return e.jsx("div",{className:"settings-overlay",onClick:i?void 0:s,children:e.jsxs("div",{className:"settings-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"settings-header",children:[e.jsxs("div",{className:"settings-title",children:[e.jsx("h2",{children:i?"Setup Required":"Settings"}),i&&e.jsx("p",{className:"setup-subtitle",children:"Configure your AI service to get started"})]}),!i&&e.jsx("button",{className:"close-button",onClick:s,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("section",{className:"settings-section",children:[e.jsx("h3",{children:"AI Service"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"endpoint",children:"Endpoint"}),e.jsx("select",{id:"endpoint",value:r,onChange:o=>C(o.target.value),className:"form-control",children:I.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))})]}),(r==="custom"||r==="ollama-remote")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"customEndpoint",children:r==="ollama-remote"?"Ollama Server URL":"Custom Endpoint URL"}),e.jsx("input",{id:"customEndpoint",type:"url",value:g,onChange:o=>U(o.target.value),placeholder:r==="ollama-remote"?"http://your-server:11434/v1":"https://api.example.com/v1",className:`form-control ${c.endpoint?"error":""}`}),c.endpoint&&e.jsx("span",{className:"error-text",children:c.endpoint}),r==="ollama-remote"&&e.jsx("div",{className:"help-text",children:"Enter the URL of your remote Ollama server (e.g., http://192.168.1.100:11434/v1)"}),(r==="custom"||r==="ollama-remote")&&z(g)&&e.jsx("button",{type:"button",className:"fetch-models-button",onClick:()=>{a(o=>({...o,ai:{...o.ai,endpoint:g}})),E(g,n.ai.apiKey)},disabled:S,children:S?"Fetching Models...":"Fetch Available Models"})]}),A&&!R&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"apiKey",children:"API Key"}),e.jsx("input",{id:"apiKey",type:"password",value:n.ai.apiKey,onChange:o=>a(h=>({...h,ai:{...h.ai,apiKey:o.target.value}})),placeholder:"Enter your API key",className:`form-control ${c.apiKey?"error":""}`}),c.apiKey&&e.jsx("span",{className:"error-text",children:c.apiKey})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"model",children:["Model",S&&e.jsx("span",{className:"loading-indicator",children:" (Loading...)"})]}),e.jsxs("div",{className:"model-input-group",children:[e.jsxs("select",{id:"model",value:n.ai.model,onChange:o=>a(h=>({...h,ai:{...h.ai,model:o.target.value}})),className:`form-control ${c.model?"error":""}`,disabled:S,children:[!n.ai.model&&e.jsx("option",{value:"",disabled:!0,children:"Select a model..."}),K().map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx("button",{type:"button",className:"refresh-models-button",onClick:()=>{L(n.ai.endpoint,r)&&E(n.ai.endpoint,n.ai.apiKey)},disabled:S||!L(n.ai.endpoint,r),title:"Refresh available models",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"})})})]}),c.model&&e.jsx("span",{className:"error-text",children:c.model}),k&&e.jsxs("span",{className:"error-text",children:["⚠️ ",k]}),d.length>0&&!S&&!k&&e.jsxs("div",{className:"help-text",children:[d.length," models available from this endpoint"]})]})]}),e.jsxs("section",{className:"settings-section",children:[e.jsx("h3",{children:"Generation Parameters"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"temperature",children:["Temperature: ",n.ai.temperature]}),e.jsx("input",{id:"temperature",type:"range",min:"0",max:"2",step:"0.1",value:n.ai.temperature,onChange:o=>a(h=>({...h,ai:{...h.ai,temperature:parseFloat(o.target.value)}})),className:"form-control range"}),e.jsxs("div",{className:"range-labels",children:[e.jsx("span",{children:"Focused"}),e.jsx("span",{children:"Balanced"}),e.jsx("span",{children:"Creative"})]}),c.temperature&&e.jsx("span",{className:"error-text",children:c.temperature})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"maxTokens",children:"Max Tokens"}),e.jsx("input",{id:"maxTokens",type:"number",min:"1",max:"8000",value:n.ai.maxTokens,onChange:o=>a(h=>({...h,ai:{...h.ai,maxTokens:parseInt(o.target.value)||1e3}})),className:`form-control ${c.maxTokens?"error":""}`}),c.maxTokens&&e.jsx("span",{className:"error-text",children:c.maxTokens})]})]}),(R||r==="ollama-remote")&&e.jsxs("section",{className:"settings-section local-info",children:[e.jsx("h3",{children:r==="ollama-remote"?"Ollama Server":"Local Server"}),e.jsx("div",{className:"info-box",children:r==="ollama-remote"?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Make sure your remote Ollama server is running and accessible."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Server:"})," Run ",e.jsx("code",{children:"ollama serve"})," on your server"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Network:"})," Ensure the server is accessible from your network"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Models:"})," Use ",e.jsx("code",{children:"ollama pull model-name"})," to download models"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"You're using a local AI server. Make sure it's running and accessible."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Ollama:"})," Run ",e.jsx("code",{children:"ollama serve"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"LM Studio:"})," Start the local server"]})]})]})})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"button secondary",onClick:w,children:"Reset to Defaults"}),e.jsxs("div",{className:"button-group",children:[!i&&e.jsx("button",{className:"button secondary",onClick:s,children:"Cancel"}),e.jsx("button",{className:"button primary",onClick:p,children:i?"Get Started":"Save Settings"})]})]})]})})};let _;const he=new Uint8Array(16);function ge(){if(!_&&(_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(he)}const y=[];for(let t=0;t<256;++t)y.push((t+256).toString(16).slice(1));function pe(t,s=0){return y[t[s+0]]+y[t[s+1]]+y[t[s+2]]+y[t[s+3]]+"-"+y[t[s+4]]+y[t[s+5]]+"-"+y[t[s+6]]+y[t[s+7]]+"-"+y[t[s+8]]+y[t[s+9]]+"-"+y[t[s+10]]+y[t[s+11]]+y[t[s+12]]+y[t[s+13]]+y[t[s+14]]+y[t[s+15]]}const fe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Z={randomUUID:fe};function V(t,s,l){if(Z.randomUUID&&!t)return Z.randomUUID();t=t||{};const i=t.random||(t.rng||ge)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,pe(i)}class Q{constructor(s){G(this,"settings");this.settings=s}updateSettings(s){this.settings=s}async sendMessage(s){var l,i,n;try{const a=[{role:"system",content:"You are a helpful AI assistant. Provide clear, concise, and helpful responses. Use markdown formatting when appropriate for code blocks, lists, and emphasis."},...s.filter(d=>!d.isTyping).map(d=>({role:d.sender==="user"?"user":"assistant",content:d.content}))],r=`${this.settings.endpoint}/chat/completions`,f=D(this.settings.endpoint),g={"Content-Type":"application/json"};this.settings.apiKey&&!f?g.Authorization=`Bearer ${this.settings.apiKey}`:this.settings.apiKey&&(g.Authorization=`Bearer ${this.settings.apiKey}`);const v={model:this.settings.model,messages:a,temperature:this.settings.temperature,max_tokens:this.settings.maxTokens,stream:!1},c=await fetch(r,{method:"POST",headers:g,body:JSON.stringify(v)});if(!c.ok){const d=await c.json();throw new Error(((l=d.error)==null?void 0:l.message)||`HTTP error! status: ${c.status}`)}return((n=(i=(await c.json()).choices[0])==null?void 0:i.message)==null?void 0:n.content)||"Sorry, I encountered an error processing your request."}catch(a){if(console.error("ChatGPT API Error:",a),a instanceof Error){if(a.message.includes("API key")||a.message.includes("auth"))return"Please check your API key in the settings.";if(a.message.includes("quota"))return"API quota exceeded. Please check your account.";if(a.message.includes("rate limit"))return"Rate limit exceeded. Please wait a moment before sending another message.";if(a.message.includes("Failed to fetch")||a.message.includes("network"))return D(this.settings.endpoint)?"Cannot connect to local server. Please ensure your local AI server is running.":"Network error. Please check your connection and try again."}return"I apologize, but I encountered an error. Please try again in a moment."}}}const P={CONVERSATIONS:"pwa_imessage_conversations",CURRENT_CONVERSATION:"pwa_imessage_current_conversation"},ve=t=>{try{console.log("Saving to localStorage:",t.length,"conversations"),localStorage.setItem(P.CONVERSATIONS,JSON.stringify(t))}catch(s){console.error("Error saving conversations:",s)}},xe=()=>{try{const t=localStorage.getItem(P.CONVERSATIONS);if(console.log("Loading from localStorage:",t?"data found":"no data"),!t)return[];const s=JSON.parse(t);return console.log("Parsed conversations:",s.length),s.map(l=>({...l,updatedAt:new Date(l.updatedAt),messages:l.messages.map(i=>({...i,timestamp:new Date(i.timestamp)}))}))}catch(t){return console.error("Error loading conversations:",t),[]}},je=t=>{try{t?localStorage.setItem(P.CURRENT_CONVERSATION,t):localStorage.removeItem(P.CURRENT_CONVERSATION)}catch(s){console.error("Error saving current conversation ID:",s)}},ye=()=>{try{return localStorage.getItem(P.CURRENT_CONVERSATION)}catch(t){return console.error("Error loading current conversation ID:",t),null}},Ne=t=>{if(!t)return"New Conversation";let l=t.trim().split(" ").slice(0,6).join(" ");return l.length>50&&(l=l.substring(0,47)+"..."),t.split(" ").length>6&&(l+="..."),l||"New Conversation"},Se=()=>{try{const t="localStorage_test";return localStorage.setItem(t,"test"),localStorage.removeItem(t),!0}catch(t){return console.error("localStorage not available:",t),!1}},Ce=()=>{const[t,s]=u.useState([]),[l,i]=u.useState(null),[n,a]=u.useState(!1),[r,f]=u.useState(null),[g,v]=u.useState(!1),[c,N]=u.useState(!1),[d,x]=u.useState(O());u.useEffect(()=>{const m=ue();if(x(m),m.ai.endpoint){const p=new Q(m.ai);f(p)}N(!0)},[]),u.useEffect(()=>{const m=xe();console.log("Loaded conversations on mount:",m.length),s(m);const p=ye();if(p&&m.length>0){const w=m.find(E=>E.id===p);i(w||null)}v(!0)},[]),u.useEffect(()=>{g&&(console.log("Saving conversations:",t.length),ve(t))},[t,g]),u.useEffect(()=>{je((l==null?void 0:l.id)||null)},[l]);const S=u.useCallback(()=>{const m={id:V(),title:"New Chat",messages:[],updatedAt:new Date};return s(p=>[m,...p]),i(m),m},[]),b=u.useCallback(m=>{const p=t.find(w=>w.id===m);p&&i(p)},[t]),k=u.useCallback(m=>{s(p=>p.filter(w=>w.id!==m)),(l==null?void 0:l.id)===m&&i(null)},[l]),M=u.useCallback(m=>{if(x(m),m.ai.endpoint)if(r)r.updateSettings(m.ai);else{const p=new Q(m.ai);f(p)}},[r]),L=u.useCallback(()=>d.ai.endpoint?D(d.ai.endpoint)?!!d.ai.model:!!(d.ai.apiKey&&d.ai.model):!1,[d]),C=u.useCallback(m=>{s(p=>p.map(w=>w.id===m.id?m:w)),(l==null?void 0:l.id)===m.id&&i(m)},[l]),U=u.useCallback(async m=>{if(!r){alert("Please set your OpenAI API key in the settings first.");return}let p=l;p||(p=S());const w={id:V(),content:m,sender:"user",timestamp:new Date},E=[...p.messages,w],K={...p,messages:E,lastMessage:m,updatedAt:new Date,title:p.messages.length===0?Ne(m):p.title};C(K),a(!0);try{const T=await r.sendMessage(E),A={id:V(),content:T,sender:"assistant",timestamp:new Date},R={...K,messages:[...E,A],lastMessage:T,updatedAt:new Date};C(R)}catch(T){console.error("Error sending message:",T);const A={id:V(),content:"Sorry, I encountered an error. Please try again.",sender:"assistant",timestamp:new Date},R={...K,messages:[...E,A],lastMessage:A.content,updatedAt:new Date};C(R)}finally{a(!1)}},[r,l,S,C]);return{conversations:t,currentConversation:l,createConversation:S,selectConversation:b,deleteConversation:k,sendMessage:U,isLoading:n,hasApiKey:c?L():!0,settings:d,updateSettings:M,settingsLoaded:c}};function we(){const{conversations:t,currentConversation:s,sendMessage:l,isLoading:i,selectConversation:n,deleteConversation:a,hasApiKey:r,updateSettings:f,settingsLoaded:g}=Ce(),[v,c]=u.useState(!0),[N,d]=u.useState(!1);u.useEffect(()=>{const C=Se();console.log("localStorage available:",C),g&&!r&&d(!0)},[r,g]),u.useEffect(()=>{c(!s)},[s]);const x=()=>{d(!0)},S=()=>{r&&d(!1)},b=async C=>{if(!r){d(!0);return}await l(C)},k=()=>{c(!1)},M=()=>{c(!0)},L=C=>{n(C),c(!1)};return v?e.jsxs("div",{className:"app",children:[e.jsx(de,{conversations:t,onSelectConversation:L,onNewConversation:k,onDeleteConversation:a,onOpenSettings:x}),e.jsx(W,{isOpen:N,onClose:S,onSettingsChange:f,required:!r})]}):e.jsxs("div",{className:"app",children:[e.jsx(re,{title:(s==null?void 0:s.title)||"ChatGPT",onBack:M,showBack:!0,onSettings:x,showSettings:!0}),e.jsx(ie,{messages:(s==null?void 0:s.messages)||[],isLoading:i}),e.jsx(le,{onSendMessage:b,disabled:i,placeholder:"Message"}),e.jsx(W,{isOpen:N,onClose:S,onSettingsChange:f,required:!r})]})}H.createRoot(document.getElementById("root")).render(e.jsx(oe.StrictMode,{children:e.jsx(we,{})}));
